# LocalAgentWeaver プロジェクト開発計画・進捗管理

## プロジェクト概要
ローカル環境で動作するLLM（Ollama/LM Studio）と連携し、チームでのドキュメントベースの対話やアイデア創出を支援する、セキュアなAIエージェントプラットフォーム。**高速RAGベクトル検索機能**を中核とした次世代AI協働プラットフォーム。

## 🎯 開発ロードマップ

### **現在のステータス**: 🔄 **PHASE 1 RAGアーキテクチャ再構築中** 
**進捗率**: 70% (MVP完了、RAG基盤実装中)

### ■ MVP（最小実用製品） - 目標期間: 2-3週間

#### プロジェクト構造・環境構築
- [x] 1. プロジェクト構造とDocker環境の初期セットアップ ✅ **完了**
- [x] 2. CI/CDパイプラインの初期設定 ✅ **完了**

#### バックエンド開発
- [x] 3. 認証機能: ユーザー登録/ログインAPI (JWT発行) ✅ **完了**
- [x] 4. プロジェクト管理機能: プロジェクトのCRUD API ✅ **完了**
- [x] 5. 基本チャット機能: Ollama/LMStudioへのプロキシAPI、履歴保存機能 ✅ **完了**
- [x] 6. LLMモデル管理API: モデル一覧取得、インストール、削除、進行状況確認API ✅ **完了**

#### フロントエンド開発
- [x] 7. 認証画面 (LAW-SC-010)、プロジェクト一覧画面 (LAW-SC-100) ✅ **完了**
- [x] 8. 基本メイン画面 (LAW-SC-200): シンプルなチャットUIのみ実装 ✅ **完了**
- [x] 9. ModelSelectorコンポーネント: 未インストールモデルの自動インストール機能 ✅ **完了**
- [x] 10.リダイレクト機能（未ログインは、必ずログイン画面にリダイレクト） ✅ **完了**

#### 開発ツール
- [x] 10. セットアップスクリプト (setup-dev.sh) の作成  ✅ **完了**

### ■ PHASE 1: 🚀 RAG統合プラットフォーム基盤 - 目標期間: 4-5週間

#### 🎯 **重要**: アーキテクチャ変更による影響
AnythingLLM参考のマルチベクトルDB構成により、既存RAG実装の**全面再構築**が必要。

#### 🔄 LlamaIndex RAGフレームワーク統合
- [ ] 11. **LlamaIndex環境構築**: 
  - LlamaIndex + LanceDB統合セットアップ
  - FastAPI統合レイヤー構築
  - 既存コードとの互換性確保
- [ ] 12. **既存RAG実装移行**: 
  - 自作ベクトル処理 → LlamaIndex VectorStoreIndex
  - 自作ドキュメント処理 → SimpleDirectoryReader + NodeParser
  - 自作検索機能 → RetrieverQueryEngine

#### LlamaIndex統合RAG処理パイプライン
- [ ] 13. **SimpleDirectoryReader統合**: 
  - ファイル形式別パーサー (TXT, MD, PDF, EXCEL, WORD, POWERPOINT)
  - メタデータ抽出・管理の統合
- [ ] 14. **NodeParser最適化**: 
  - インテリジェントチャンキング (意味単位分割)
  - プロジェクト特化のノード分割戦略
- [ ] 15. **VectorStoreIndex構築**: 
  - LanceDB/Qdrant統合によるベクトルインデックス
  - 高速並列処理・バッチ処理対応
- [ ] 16. **RetrieverQueryEngine**: 
  - 高精度類似度検索・ランキング機能
  - レスポンス時間最適化 (目標: <100ms)

#### RAG統合チャット処理
- [ ] 17. **LlamaIndex ChatEngine統合**: 質問→検索→拡張→生成の完全自動化
- [ ] 18. **出典追跡システム**: LlamaIndexのResponse Source統合によるドキュメント引用
- [ ] 19. **RAG統合API**: FastAPI + LlamaIndexによる統合エンドポイント

#### フロントエンド RAG統合
- [x] 20. チーム管理UI: チーム選択・編集モーダル (LAW-SC-215, LAW-SC-210) ✅ **完了**
- [x] 21. ドキュメント管理UI: ファイルアップロード、有効/無効切り替えUI ✅ **完了**
- [x] 22. LLMモデル切替UI: チャット画面からリアルタイムでモデルを切り替える機能 ✅ **完了**
- [x] 23. 応答時間表示機能: チャット入力からLLMの応答が完了するまでの経過時間表示 ✅ **完了**
- [ ] 24. **引用表示UI**: リアルタイム出典情報表示、ドキュメントへの直接リンク
- [ ] 25. **ベクトル化進行状況UI**: ドキュメント処理状況のリアルタイム表示

### ■ PHASE 2: 🎨 エンタープライズ機能・UX最適化 - 目標期間: 3-4週間

#### 高度なRAG機能
- [ ] 26. **マルチモーダルRAG**: 画像・表・グラフの理解と検索
- [ ] 27. **RAG精度最適化**: 
  - ハイブリッド検索 (セマンティック + キーワード)
  - 動的チャンクサイズ調整
  - コンテキスト重要度スコアリング
- [ ] 28. **RAG分析ダッシュボード**: 検索パフォーマンス可視化

#### コラボレーション・共有機能
- [ ] 29. **プロジェクト共有**: ユーザー間でのプロジェクト共有、権限管理API
- [ ] 30. **共有機能UI**: プロジェクト共有設定画面、共有されたプロジェクト一覧
- [ ] 31. **コラボレーション履歴**: 共有プロジェクトでの活動ログ・通知

#### プレミアムUX機能
- [ ] 32. **レスポンシブデザイン**: モバイル・タブレット対応
- [ ] 33. **ダークモード**: システム設定連動ダークテーマ
- [ ] 34. **アクセシビリティ**: WCAG 2.1 AA準拠
- [ ] 35. **高度な検索UI**: ファセット検索、フィルター、ソート機能

### ■ PHASE 3: 🏢 エンタープライズ・プロダクション準備 - 目標期間: 4-5週間

#### スケーラビリティ・パフォーマンス
- [ ] 36. **マルチテナント対応**: テナント分離、リソース制限
- [ ] 37. **負荷分散**: ベクトル検索の水平スケーリング
- [ ] 38. **クエリ最適化**: PostgreSQL + ベクトルDB + Redis統合キャッシング
- [ ] 39. **バックグラウンドジョブ**: Celery/RQ によるベクトル化処理キューイング

#### モニタリング・可観測性
- [ ] 40. **構造化ログ**: OpenTelemetry統合、分散トレーシング
- [ ] 41. **メトリクス収集**: Prometheus + Grafana ダッシュボード
- [ ] 42. **ヘルスチェック**: エンドポイント監視、アラート機能
- [ ] 43. **パフォーマンス監視**: RAG検索レスポンス時間、スループット追跡

#### セキュリティ・コンプライアンス
- [ ] 44. **認証強化**: MFA、SSO統合 (SAML/OIDC)
- [ ] 45. **ファイルセキュリティ**: ウイルススキャン、DLP (Data Loss Prevention)
- [ ] 46. **APIセキュリティ**: レート制限、DDoS保護、OWASP対策
- [ ] 47. **データ暗号化**: 保存時・転送時暗号化、秘密情報管理

#### デプロイメント・運用自動化
- [ ] 48. **本番環境構築**: Kubernetes/Docker Swarm 対応
- [ ] 49. **CI/CD パイプライン**: 自動テスト、デプロイメント、ロールバック
- [ ] 50. **バックアップ・リカバリ**: ベクトルデータ + メタデータの定期バックアップ

## 技術スタック

### バックエンド
- **フレームワーク**: Python, FastAPI
- **RAGフレームワーク**: **LlamaIndex** (AnythingLLM実証済み)
- **メタデータDB**: PostgreSQL
- **ベクトルDB**: LanceDB (開発環境) / Qdrant (本番環境)
- **キャッシュ**: Redis
- **埋め込みサービス**: sentence-transformers / Ollama Embeddings
- **テスト**: Pytest

### フロントエンド
- **フレームワーク**: TypeScript, React, Next.js
- **UIライブラリ**: Tailwind CSS, Shadcn/ui
- **テスト**: Jest/Playwright

### インフラ
- **コンテナ化**: Docker, Docker Compose
- **LLM実行環境**: Ollama / LM Studio (設定により切替可能)
- **ベクトルDB**: LanceDB (開発用) / Qdrant (本番用)
- **埋め込み処理**: sentence-transformers コンテナ

## 開発指針

### テスト駆動開発（TDD）
- 機能実装前にテストコードを作成
- 高いコードカバレッジを維持
- 継続的な品質保証

### セキュリティ
- JWT認証によるセキュアなAPI
- ファイルアップロードのMIMEタイプ検証
- CORS設定とレート制限
- ユーザー入力のサニタイズ・バリデーション

### パフォーマンス
- 構造化ログの出力
- リクエストID付与による処理追跡
- Redisキャッシング活用
- DBクエリ最適化

## 📊 進捗状況・優先度管理

### **🎯 現在のフェーズ**: PHASE 1 RAG統合プラットフォーム基盤
**進捗率**: 75% | **期限**: 4週間後 | **リスク**: 🟡 中 (アーキテクチャ変更による影響)

### **⭐ 最優先タスク (Next 2 weeks)**
1. **🔥 クリティカル**: LlamaIndex + LanceDB統合環境構築 (タスク11)
2. **🔥 クリティカル**: 既存RAG実装の段階的移行 (タスク12)
3. **⚡ 高優先度**: SimpleDirectoryReader統合・テスト (タスク13)
4. **⚡ 高優先度**: VectorStoreIndex構築・最適化 (タスク15)

### **🎉 完了済みマイルストーン**
#### **MVP (100%完了)**
- ✅ プロジェクト構造・Docker環境・CI/CDパイプライン
- ✅ 認証機能・プロジェクト管理・基本チャット機能
- ✅ LLMモデル管理・自動インストール機能
- ✅ 基本UI (認証、ダッシュボード、メインチャット画面)
- ✅ チーム管理・ドキュメント管理UI
- ✅ 応答時間表示機能

#### **PHASE 1 進行中 (75%完了)**
- ✅ チーム・エージェント管理機能: CRUD API、プリセット定義
- ✅ 基本ドキュメント処理: ファイルアップロード (TXT, MD, PDF)
- ✅ 基本RAG機能: 簡易ベクトル検索・コンテキスト利用
- ✅ フロントエンドUI: チーム管理、ドキュメント管理、LLMモデル切替

### **🚨 ブロッカー・リスク管理**
| リスク | 影響度 | 対応策 | 期限 |
|--------|--------|--------|------|
| **LlamaIndex統合による既存RAG破損** | 🔴 高 | 段階的移行 + POC先行 + 並行テスト | 2週間 |
| **LlamaIndexの学習コスト** | 🟡 中 | 公式ドキュメント + AnythingLLMコード参考 | 1週間 |
| **FastAPI統合の複雑性** | 🟡 中 | LlamaIndex公式FastAPI統合例を活用 | 2週間 |
| **パフォーマンス要件 (<100ms) 達成** | 🟡 中 | LlamaIndex + LanceDBでベンチマークテスト早期実装 | 3週間 |

### **🎯 次フェーズ予告**
**PHASE 2 (3-4週間後開始予定)**: エンタープライズ機能・UX最適化
- マルチモーダルRAG、ハイブリッド検索
- プロジェクト共有・コラボレーション機能
- レスポンシブデザイン・ダークモード・アクセシビリティ

---

---

## 📝 変更履歴
| 日付 | 変更内容 | 影響 |
|------|----------|------|
| 2025-08-24 | **RAGアーキテクチャ全面見直し**: AnythingLLM参考のマルチベクトルDB構成採用 | 🔴 **重大** - 既存実装要再構築 |
| 2025-08-24 | **ベクトルDB変更**: Chroma → LanceDB (開発環境) | 🟡 **中程度** - Docker設定・統合ライブラリ変更 |
| 2025-08-24 | **RAGフレームワーク採用**: 自作実装 → LlamaIndex統合 | 🔴 **重大** - 開発効率向上・技術リスク軽減 |
| 2025-08-24 | タスク優先度管理・リスク管理プロセス導入 | 🟢 プロジェクト管理改善 |
| 2025-08-24 | PHASE 1期間延長 (3-4週間 → 4-5週間) | 🟡 スケジュール影響 |

*最終更新: 2025-08-24*